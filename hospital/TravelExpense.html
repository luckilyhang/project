<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" style="height:100%">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title></title>
    <link href="css/Common/MuiCss/mui.min.css" rel="stylesheet" />
    <link href="css/Common/MuiCss/mui.picker.min.css" rel="stylesheet" />
    <link href="css/Common/MuiCss/mui.poppicker.css" rel="stylesheet" />
    <link href="css/mui.indexedlist.css" rel="stylesheet" />
    <link href="css/Common/layer.css" rel="stylesheet" type="text/css">
    
    <link href="css/Common/mobiscroll_003.css" rel="stylesheet" type="text/css">
    <link href="css/Common/mobiscroll_002.css" rel="stylesheet" type="text/css">
    <link href="css/Common/mobiscroll.css" rel="stylesheet" type="text/css">
    <style>
        * { -webkit-user-select: text; -user-select: text; }
        #TravelExpense {
            padding-left: 1%;
            padding-right: 5%;
            padding-bottom: 5%;
        }

        td {
        padding-top:10px;
      
        }
        .TravelExpense {
            border: none;
            margin-top: 3%;
            padding-top: 2%;
            padding-bottom: 2%;
            padding-left: 5%;
            background-color: white;
            font-size: 80%;
            border-radius: 8px;
            color: #333;
            box-shadow: 0px 0px 5px #DDDDDD;
        }

        table {
            width: 100%;
        }

        .td_1 {
            width: 32%;
        }
        .td_2 {
            cursor:pointer !important;
        }

        img {
            transform:scale(.6);
        }

        input {
            border: none;
            outline: none;
        }

        .button_next {
            width: 90%;
            height: 15%;
        }

        .button_confirm input {
            color: white;
            width: 60%;
            height: 28px;
            margin-left: 18%;
            margin-bottom: 5%;
            border-radius: 50px;
            background-color: #3295fa;
            border: none;
            outline: none;
        }

        #entourage table .td_1 {
            padding-left:0;
        }
       
        .zz_yes {
            display:none;
        }
        input::-webkit-input-placeholder {
            color: #999;
            font-size:90%;
        }
        .mask {
            width: 100%;
            height: 100%;
            z-index: 10;
            background-color: white;
            position: fixed;
            top: 0;
            left: 0;
        }
        .nomask {
            display:none;
        }
        #CCDate {
            width:100%;
        }
        .button_confirm {
        margin-right:5%;
        
        }
        #confirm {
        height:20%;
        width:100%;
        margin-left:0;
        margin-right:5%;
        font-size:100%;
        }
        /*框架修改*/
        .mui-poppicker {
            background-color:white;
        }
        .mui-picker {
            background-color:white;
        }
        .mui-poppicker-header {
            background-color:white;
        }
        .mui-btn {
            color:#3295fa;
            border:none;
            background-color:none;
        }
        .mui-btn-blue, .mui-btn-primary, input[type=submit] {
            background-color:white;
        }
        .mui-pciker-list li.highlight {
            color:#3295fa;
        }
        .mui-poppicker-header {
            border-radius:20px;
            padding-left:20px;
            padding-right:20px;
        }
        .mui-poppicker, .mui-active {
            border-radius:20px;
            height:180px;
        }
        .mui-poppicker-body {
            border: none;
        }
        .mui-pciker-rule, .mui-pciker-rule-ft {
            top: 60px;
        }

        .mui-pciker-list {
            top: 60px;
        }
        .mui-pciker-rule-ft {
            border-top:solid 1px #3295fa;
            border-bottom:solid 1px #3295fa;
            width:30%;
            margin-left:35%;
        }
        .mui-backdrop {
            height:100%;
        }
        #picture {
          left:0;
          height:50%;
        }
       .mui-popover.mui-popover-action .mui-table-view {
           position:fixed;
           width:100%;
           height:100%;
           margin:0;
           bottom:0;
           border-top-left-radius:20px;
           border-top-right-radius:20px;
        }
        .mui-table-view-cell {
        padding:0;
        }
        .mui-indexed-list-search .mui-input-row .mui-search {
            pointer-events: none !important;
        }

        .mui-input-clear .mui-indexed-list-search-input {
            -webkit-user-select: auto !important;
        }
        .SelectJob { 
            font-size:15px !important;
        }
        #showTrainPicker { font-size: 15px !important; }
        #showUserPicker { font-size: 15px !important;color:#999}
        .td-left,.ScName { font-size: 17px !important; }
        #lsData1 td:nth-of-type(1) > span { font-size: 17px; }
        #lsData1 td:nth-of-type(2) > span { font-size: 15px; }
        #showUserPicker { font-size: 15px !important; }
        #showTrainPicker { color:#999;}
        .SelectJob { color:#999}
        #CCDays {font-size:15px !important;}
    </style>
</head>
<body style="background-color:#f2f4f7;margin-left:4%;margin-right:5%;font-size:100%;height:100%;margin-right:0;">
    <div id="TravelExpense">
        <div id="area1" class="TravelExpense">
            <div style="width:20px;height:20px;float:left;left:10px;margin-top:78px;position:absolute;z-index:2;background-color:#f2f4f7;border-radius:50%;"></div>
            <div style="width:20px;height:20px;float:right;margin-top:50px;position:absolute;z-index:2;right:10px;background-color:#f2f4f7;border-radius:50%;"></div>
             <table border="0" >
                <tbody>
                    <tr id="lsData1">
                        <td class="td_1"><span class="td-left">出差人员</span></td>
                        <td class="td_2" colspan="1" width="30%"><span id="vName"></span></td>
                        <td id="leadSex" data-sex="1" style="display:flex;justify-content:space-around;">
                            <div onclick="selectSex(this)"style="display: flex;align-items:center;" >
                                <img src="img/no@2x.png">
                                <span style="padding-top:3px;">男</span>
                            </div>
                            <div onclick="selectSex(this)" style="display: flex;align-items:center;">
                                <img src="img/wxz@2x.png">
                                <span style="padding-top:3px;">女</span>
                            </div>
</td>
    <!--<td class="td_3" id="leadSex" data-sex="1" style="position:relative">
    <span onclick="selectSex(this)" style=" align-items: center; padding-right: 15px; padding-left: 15px; "><span style="float:right;padding-top:5px;">女</span><img src="img/wxz@2x.png" style="float:right"></span><span onclick="selectSex(this)" style="float: right; position:absolute;left:-11px; align-items: center;"><span style="float:right;padding-top:5px;">男</span><img src="img/xz@2x.png" style="float:right"></span></td>-->
</tr>
                    <tr>
                        <td class="td_1"><span class="td-left">所属部门</span></td>
                        <td class="td_2" colspan="2"><span id="DepName" style="font-size:15px"></span></td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">职务职称</span></td>
                        <td class="td_2">
                        <!--<span id="showUserPicker" style="color:#999;font-size:90%;">请选择职称</span>-->
                            <select id="showUserPicker" onchange="SelectJob(this)" style="font-size:15px; height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">
                                <option value="请选择职称" selected disabled="disabled">请选择职称</option>
                                <option value="院领导">院领导</option>
                                <option value="正高">正高</option>
                                <option value="中层干部">中层干部</option>
                                <option value="其他人员">其他人员</option>


                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">出发时间</span></td>
                        <td class="td_2" colspan="2"><input id="CCDate" /></td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">返回时间</span></td>
                        <td class="td_2" colspan="2">
                        <input type="type" id="Time" placeholder="请选择出发日期" style="width:90%;"  class="dwtd" >
                        </td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">自然天数</span></td>
                        <td class="td_2"><span id="CCDays" style="font-size:15px"></span></td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">出差地点</span></td>
                        <td class="td_2"><span id="CCAddress" style="font-size:15px"></span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="area2" class="TravelExpense">
            <table border="0">
                <tbody>
                    <tr id="lsData2">
                        <td class="td_1"><span class="td-left">单位承担</span></td>
                        <td class="td_3" id="originBear"><span onclick="selectYN(this)" data_zz="no" style="float: right; float: right; padding-right: 15px; padding-left: 15px;  align-items: center;"><span style="float:right;padding-top:5px;">否</span><img src="img/no@2x.png" style="float:right" /></span><span onclick="selectYN(this)" data_zz="yes" style="float: right; align-items: center;"><span style="float:right;padding-top:5px;">是</span><img src="img/no@2x.png" style="float:right" /></span></td>
                    </tr>
                    <tr>
                        <td class="td_1" ><span class="td-left">选择同住宿发票人员</span></td>
                        <td class="td_2" style=""><img src="img/tianjia@2x.png" style="width:10%;margin-left:10%" onclick="flowPeople()" /></td>
                    </tr>
                    <tr>
                        <td id="entourage" colspan="2" style="padding-top:0;">
                            <!--<table>
                                <tr>
                                    <td class="td_1"><span>张三：</span></td>
                                    <td class="td_2"><span style="color:#999;font-size:90%;">请选择职称</span></td>
                                    <td class="td_3"><span onclick="selectSex(this)" style="float:right;padding-right:15px;padding-left:15px;"><span style="float:right;padding-left:20%;">女</span><img src="img/wxz@2x.png" style="float:right"></span><span onclick="selectSex(this)" style="float:right"><span style="float:right;padding-left:20%;">男</span><img src="img/no@2x.png" style="float:right"></span></td>
                                </tr>
                            </table>
                            <table>
                                <tr>
                                    <td class="td_1"><span>李四：</span></td>
                                    <td class="td_2"><span style="color:#999;font-size:90%;">请选择职称</span></td>
                                    <td class="td_3"><span onclick="selectSex(this)" style="float:right;padding-right:15px;padding-left:15px;"><span style="float:right;padding-left:20%;">女</span><img src="img/wxz@2x.png" style="float:right"></span><span onclick="selectSex(this)" style="float:right"><span style="float:right;padding-left:20%;">男</span><img src="img/no@2x.png" style="float:right"></span></td>
                                </tr>
                            </table>-->
                        </td>
                    </tr>
                    <tr id="zz1" class="zz_no">
                        <td class="td_1"><span class="td-left">住宿天数</span></td>
                        <td class="td_2"><span id="ZSDays" style="font-size:15px;"></span></td>
                    </tr>
                    <tr id="zz2" class="zz_no">
                        <td class="td_1"><span class="td-left">住宿间数</span></td>
                        <td class="td_2"><input type="text" id="roomNum" placeholder="请输入住宿间数" oninput="this.value=this.value.replace(/[^0-9.]+/,'');" /></td>
                    </tr>
                    <tr id="zz3" class="zz_no">
                        <td class="td_1"><span class="td-left">住宿发票</span></td>
                        <td class="td_2"><input type="text" id="ZSMoney" placeholder="请输入报销金额" oninput="this.value=this.value.replace(/[^0-9.]+/,'');" /></td>
                    </tr>
                    <tr id="zz4" class="zz_no">
                        <td class="td_1"><span class="td-left">住宿实报</span></td>
                        <td class="td_2"><input id="ZSRealMoney" type="text" placeholder="--"  readonly/></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="area3" class="TravelExpense">
            <table border="0">
                <tbody> 
                    <tr>
                        <td class="td_1"><span id="JTType" class="td-left"></span></td>
                        <td class="td_2">
                            <select id="showTrainPicker" style="width:112px;font-size:15px;height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">
                               <option>请选择类型</option>     
                            </select>




                        <!--<span  style="color:#999;font-size:90%;">请选择类型</span>-->
                        </td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">车票(往)</span></td>
                        <td class="td_2"><input type="text" id="leaveMoney"  placeholder="请输入车票金额" /></td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">车票(返)</span></td>
                        <td class="td_2"><input type="text" id="returnMoney"  placeholder="请输入车票金额" /></td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">交通实报</span></td>
                        <td class="td_2"><input type="number" id="realMoney" placeholder="--" readonly /></td>
                    </tr>
                    <tr>
                        <td class="td_1"><span class="td-left">同住宿发票人员</span></td>
                        <td class="td_2"></td>
                    </tr>
                    <tr>
                        <td id="_entourage" colspan="2">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="area4" class="TravelExpense">
            <table>
                <tr>
                    <td><span class="td-left">参加会议培训</span></td>
                    <td id="meetPlan"><span onclick="selectYN(this)" data_PX="no" style="float:right;padding-right:15px;padding-left:15px;align-items:center;"><span style="float:right;padding-top:5px;">否</span><img id="PX_no" src="img/no@2x.png" style="float:right;"></span><span onclick="selectYN(this)" data_px="yes" style="float: right;  align-items: center;"><span style="float:right;padding-top:5px;">是</span><img src="img/no@2x.png" style="float:right"></span></td>
                </tr>
               
                <tr id="hy_2" class="zz_yes">
                    <td class="td_1"><span>会务发票金额</span></td>
                    <td class="td_2"><input type="text" id="meetMoney" oninput="this.value=this.value.replace(/[^0-9.]+/,'');" placeholder="请输入报销金额"></td>
                </tr>
                <tr id="hy_1" class="zz_yes">
                    <td class="td_1"><span id="HWRealMoney" style="color:red">会务费实报</span></td>
                    <td class="td_2"><input type="number"  id="meetRealMoney" placeholder="--" readonly></td>
               </tr>
            </table>
        </div>
    </div>

    <div class="button_confirm">
        <input id="confirm" type="button" value="确定" onclick="nextInfo()" />
    </div>

    <div id="picture" class="mui-popover mui-popover-action mui-popover-bottom">
        <ul class="mui-table-view">
            <li >
                <div class="mui-poppicker-header">
                    <button class="mui-btn mui-poppicker-btn-cancel">取消</button>
                    <button class="mui-btn mui-btn-blue mui-poppicker-btn-ok">确定</button>
                    <div class="mui-poppicker-clear"></div>
                </div>
            </li>
            <li style="color:white;height:6%;font-size:60%;">
                <span style="background-color:#c3e1ff;border-radius:20px;padding-left:5px;padding-right:5px;height:100%;float:left;position:relative;margin-left:5%;margin-right:5%;width:23%"><span style="height:100%;float:left;line-height:100%;margin-top:5%;">12121&nbsp;&nbsp;&nbsp;王大明</span><img src="img/guanbi@2x.png" style="width:10px;float:right;top:-2px;position:absolute;right:-4px;" /></span>
                <span style="background-color:#c3e1ff;border-radius:20px;padding-left:5px;padding-right:5px;height:100%;float:left;position:relative;margin-left:5%;margin-right:5%;width:23%"><span style="height:100%;float:left;line-height:100%;margin-top:5%;">12121&nbsp;&nbsp;&nbsp;王大明</span><img src="img/guanbi@2x.png" style="width:10px;float:right;top:-2px;position:absolute;right:-4px;" /></span>
                <span style="background-color:#c3e1ff;border-radius:20px;padding-left:5px;padding-right:5px;height:100%;float:left;position:relative;margin-left:5%;margin-right:5%;width:23%"><span style="height:100%;float:left;line-height:100%;margin-top:5%;">12121&nbsp;&nbsp;&nbsp;王大明</span><img src="img/guanbi@2x.png" style="width:10px;float:right;top:-2px;position:absolute;right:-4px;" /></span>
             </li>
            <li>
                <div class="mui-indexed-list-search mui-input-row mui-search">
                    <input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="" data-input-clear="1" data-input-search="1"><span class="mui-icon mui-icon-clear mui-hidden"></span><span class="mui-placeholder"><span class="mui-icon mui-icon-search"></span><span>搜索机场</span></span>
                </div>
            </li>
            
        </ul>
    </div>
    <div id="mask"class="nomask" >
    </div>
    <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="js/Common/mui.min.js"></script>
    <script src="js/Common/mui.picker.js"></script>
    <script src="js/Common/mui.poppicker.js"></script>
    <script src="js/Common/layer.js"></script>
    <script type="text/javascript" src="js/Common/date.js"></script>
    <script src="js/Common/mobiscroll_002.js" type="text/javascript"></script>
    <script src="js/Common/mobiscroll_004.js" type="text/javascript"></script>
    <script src="js/Common/mobiscroll.js" type="text/javascript"></script>
    <script src="js/Common/mobiscroll_003.js" type="text/javascript"></script>
    <script src="js/Common/mobiscroll_005.js" type="text/javascript"></script>
    <script>
 
        //住宿费标准
        YLDandZG = 0;
        Other = 0;
        var addressID = JSON.parse(localStorage.getItem("PreSQ")).CCAddressID;
        window.onload=function(){
        $.ajax({
            type: "get",
            dataType: 'json',
            url: "http://120.27.217.7:7001/CLFApply/WBS/CLFApply/CLFApplyWBS.asmx/WBS_GetPsnBZ?addressID="+"232",
            success: function (data) {
                if (data.success == '0') {
                    YLDandZG = parseFloat(JSON.parse(data.data).YLD);
                    Other =  parseFloat(JSON.parse(data.data).Other);
                } else {
                    tatle(data.msg)
                }
                
            },
            error: function (e) {
                //console.log(e)
            }
        })
        }
    </script>

        <script>
            dd = '';
            cc = '';
            personArr = [];
            bb = '';
            ee = '';
            ff = '';
            leav = '';
            ret = '';
            ZcArr = [];
            adc = '';
      
            $(function () {
                var currYear = (new Date()).getFullYear();
                var opt = {};
                opt.date = { preset: 'date' };
                opt.datetime = { preset: 'datetime' };
                opt.time = { preset: 'time' };
                opt.default = {
                    theme: 'android-ics light', //皮肤样式
                    display: 'modal', //显示方式 
                    mode: 'scroller', //日期选择模式
                    dateFormat: 'yyyy/mm/dd',
                    lang: 'zh',
                    showNow: true,
                    nowText: "今天",
                    startYear: currYear, //开始年份
                    endYear: currYear+10//结束年份
                };
            
                $("#CCDate").mobiscroll($.extend(opt['date'], opt['default']));
                $("#Time").mobiscroll($.extend(opt['date'], opt['default']));
              
                var optDateTime = $.extend(opt['datetime'], opt['default']);
                var optTime = $.extend(opt['time'], opt['default']);
                $("#appDateTime").mobiscroll(optDateTime).datetime(optDateTime);

                });
        




                //页面初始数据
            function GetQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }
            function getDays(day1, day2) {
                var s1 = new Date(day1);
                var s2 = new Date(day2);
                var days = s2.getTime() - s1.getTime();
                var time = parseInt(days / (1000 * 60 * 60 * 24));
                return time;
            }
            //console.log(JSON.parse(decodeURI(GetQueryString("content"))).vName);
            document.getElementById("vName").innerText = JSON.parse(decodeURI(GetQueryString("content"))).vName;
            document.getElementById("DepName").innerText = JSON.parse(decodeURI(GetQueryString("content"))).DepName;
            document.getElementById("CCDate").value = decodeURI(GetQueryString("CCDate")).split('--')[0];
            console.log(decodeURI(GetQueryString("CCDate")).split('--')[0]);
            console.log(document.getElementById("CCDate").value)
            document.getElementById("Time").value = decodeURI(GetQueryString("CCDate")).split('--')[1];
            console.log(decodeURI(GetQueryString("CCDate")).split('--')[1]);
            document.getElementById("JTType").innerText = JSON.parse(decodeURI(GetQueryString("content"))).CFTraffic+"类型";
            //$('.entertime').html(decodeURI(GetQueryString("CCDate")).split('--')[0]);
            //document.querySelector(".leavetime").innerText = decodeURI(GetQueryString("CCDate")).split('--')[1];
                 //console.log(decodeURI(GetQueryString("CCDate")).split('--')[1]),
         
            document.getElementById("CCAddress").innerText = JSON.parse(decodeURI(GetQueryString("content"))).CCAddress;
            //console.log(document.getElementById("CCDate").value);
            //console.log(document.getElementById("Time").value);

            document.getElementById("CCDays").innerText = getDays(document.getElementById("CCDate").value,
                      document.getElementById("Time").value),

            console.log(getDays(document.getElementById("CCDate").value,document.getElementById("Time").value))

                      document.getElementById("ZSDays").innerText = getDays(document.getElementById("CCDate").value, document.getElementById("Time").value) - 1
            $('#Time').on('change',function () {

             
                document.getElementById("CCDays").innerText = getDays(document.getElementById("CCDate").value,
                          document.getElementById("Time").value),
                          document.getElementById("ZSDays").innerText = getDays(document.getElementById("CCDate").value, document.getElementById("Time").value) - 1
            })
          
                
            //临时数据
            if (localStorage.getItem("lsData1")) {
                document.getElementById("lsData1").innerHTML = localStorage.getItem("lsData1");
            }
            if (localStorage.getItem("lsData2")) {
                document.getElementById("lsData2").innerHTML = localStorage.getItem("lsData2");
            }
            if (localStorage.getItem("area4")) {
                document.getElementById("area4").innerHTML = localStorage.getItem("area4");
            }
            //住宿发票报销金额
            document.getElementById("ZSMoney").onkeyup = function () {
                if (!document.getElementById("roomNum").value) {
                    document.getElementById("ZSMoney").value = "";
                    tatle('请先选择住宿间数');
                    return;
                }
                if(document.getElementById("showUserPicker").value=="请选择职称"){
                    document.getElementById("ZSMoney").value = "";
                    tatle('请先选择职称');
                    return;
                }
                for(var i=0;i<document.getElementById("entourage").children.length;i++){
                    if (document.getElementById("entourage").children[i].firstElementChild.firstElementChild.children[1].lastElementChild.innerText == "请选择职称") {
                        document.getElementById("ZSMoney").value = "";
                        tatle('请先选择随从人员职称');
                        return;
                    }
                }
                if (!document.getElementById("leadSex").getAttribute('data-sex')) {
                    document.getElementById("ZSMoney").value = "";
                    tatle('请选择领队性别');
                    return;
                }
                for (var i = 0; i < $('.dataSex').length; i++) {
                    if (!$('.dataSex')[i].getAttribute('data-sex')) {
                        document.getElementById("ZSMoney").value = "";
                        tatle('请选择随从人员性别');
                        return;
                    }
                }
                //打包报销人员的姓名、性别、职称
                var CCpeople = [];
                CCpeople.push({
                    vName: document.getElementById("vName").innerText,
                    sex: document.getElementById("leadSex").getAttribute("data-sex"),
                    ZCName: document.getElementById("showUserPicker").value
                });
                for (var i = 0; i < $('.dataSex').length; i++) {
                    CCpeople.push({
                        vName: $('.dataSex')[i].previousSibling.previousSibling.lastElementChild.innerText,
                        sex: $('.dataSex')[i].getAttribute("data-sex"),
                        ZCName: $('.dataSex')[i].previousSibling.lastElementChild.innerText
                    });
                }

                var maxZSMoney = 0;//最大住宿费用
                var YLDandZG_JS = 0;//院领导或正高住的间数（独自一间）
                var Other_Man_JS = 0;//其他男的住几间（2男一间，2女一间）
                var Other_Girl_JS = 0;//其他女的住几间
                var numMan = 0;//非院领导或正高时，第几个男的
                var numGirl = 0;//非院领导或正高时，第几个女的
                for (var i = 0; i < CCpeople.length; i++) {
                    if (CCpeople[i].ZCName == "院领导" || CCpeople[i].ZCName=="正高") {
                        YLDandZG_JS += 1;
                    } else {
                        if (CCpeople[i].sex == '1') {
                            numMan += 1;
                            var ss = numMan % 2;
                            if (numMan % 2 != 0) {
                                Other_Man_JS += 1;
                            }
                        } else {
                            numGirl += 1;
                            var ss = numGirl % 2;
                            if (numGirl % 2 != 0) {
                                Other_Girl_JS += 1;
                            }
                        }
                    }
                }
                maxZSMoney += YLDandZG * parseFloat($('#ZSDays').text()) * YLDandZG_JS;
                maxZSMoney += Other * parseFloat($('#ZSDays').text()) * Other_Man_JS;
                maxZSMoney += Other * parseFloat($('#ZSDays').text()) * Other_Girl_JS;
                if (parseFloat(document.getElementById("ZSMoney").value) <= maxZSMoney || document.getElementById("ZSMoney").value == '') {
                    document.getElementById("ZSRealMoney").value = document.getElementById("ZSMoney").value;
                } else {
                    document.getElementById("ZSRealMoney").value = maxZSMoney;
                }
            }
            //领队交通报销金额
            document.getElementById("returnMoney").onkeyup = function () {
                var _a = document.getElementById("leaveMoney").value;
                var _b = document.getElementById("returnMoney").value;
                if (_a && !_b) {
                    document.getElementById("realMoney").value = parseFloat(_a)
                } else if (!_a && _b) {
                    document.getElementById("realMoney").value = parseFloat(_b)
                } else if (_a && _b) {
                    document.getElementById("realMoney").value = parseFloat(_a) + parseFloat(_b)
                } else if (!_a && !_b) {
                    document.getElementById("realMoney").value = "";
                }
            }
            document.getElementById("leaveMoney").onkeyup = function () {
                var _a = document.getElementById("leaveMoney").value;
                var _b = document.getElementById("returnMoney").value;
                if (_a && !_b) {
                    document.getElementById("realMoney").value = parseFloat(_a)
                } else if(!_a && _b) {
                    document.getElementById("realMoney").value = parseFloat(_b)
                } else if (_a && _b) {
                    document.getElementById("realMoney").value = parseFloat(_a) + parseFloat(_b)
                } else if (!_a && !_b) {
                    document.getElementById("realMoney").value = "";
                }
            }
            //会议发票报销
            document.getElementById("meetMoney").onkeyup = function () {
                document.getElementById("meetRealMoney").value = parseFloat(document.getElementById("meetMoney").value)
            }
        </script>
       
    <script>
        document.getElementById('showUserPicker').onclick = function () {
            this.setAttribute('data-s', 1);
        }
        //随从人员选择职称后加载交通类型
        function SelectJob(ele) {
           
            var vFlag = "";
            var zw = "";
            if (ele.value == "院领导") {
                zw = "1";
            } else if (ele.value == "正高") {
                zw = "1";
            } else if (ele.value == "中层干部") {
                zw = "2";
            } else if (ele.value == "其他人员") {
                zw = "2";
            }
                if (JSON.parse(decodeURI(GetQueryString("content"))).CFTraffic == "飞机") {
                    var vFlag = "1";
            } else {
                    var vFlag = "0";
            }
            $.ajax({
                type: "get",
                dataType: 'json',
                data: { param: JSON.stringify({ 'vFlag': vFlag, ZW: zw }) },
                url: "http://120.27.217.7:7001/CLFApply/WBS/CLFApply/CLFApplyWBS.asmx/WBS_GetTrafficType",
                success: function (data) {
                    var html = "";
                    var SelectTraffic = document.querySelectorAll('.SelectTraffic');
                    if (data.success == "0") {
                        html += '<option disabled>请选择交通类型</option>';
                        for (var i = 0; i < JSON.parse(data.data).length;i++){
                            html += '<option value="' + JSON.parse(data.data)[i].HC_Name + '" selected="">' + JSON.parse(data.data)[i].HC_Name + '</option>';
                        }
                        if (ele.getAttribute('data-s') == 1) {
                            //$("#showUserPicker option[value='请选择职称']").remove()
                            document.getElementById('showTrainPicker').innerHTML = html;
                            document.getElementById('showTrainPicker').style.color = "#000";
                        
                        } else {
                            for (var i = 0; i < SelectTraffic.length; i++) {
                                if (SelectTraffic[i].parentNode.previousSibling.lastElementChild.innerText == ele.parentNode.previousSibling.lastElementChild.innerText) {
                                    SelectTraffic[i].style.color = "#000"
                                    SelectTraffic[i].innerHTML = html;
                                }
                            }
                        
                        }
                       
                       
                    } else {
                    }
                },
                error: function (e) {
                    console.log(e)
                }
            })
         }

        //(function ($, doc) {
        //    $.init();
        //    $.ready(function () {

        //    //火车类型选择
        //        var trainPicker = new $.PopPicker();
        //        var trainData = [];
        //    //非正高人员可选类型
        //        var personDatd = [];
        //        if (JSON.parse(decodeURI(GetQueryString("content"))).CFTraffic == "飞机") {
        //            var vFlag = 1;
        //} else {
        //            var vFlag = 0;
        //}
        //        $.ajax({
                 
        //    type: "get",
        //    dataType: 'json',
        //    data: { param: JSON.stringify({ 'vFlag': vFlag, ZW: '1' }) },
        //    url: "http://120.27.217.7:7001/CLFApply/WBS/CLFApply/CLFApplyWBS.asmx/WBS_GetTrafficType",
        //    success: function (data) {
                      
        //                if (data.success == "0") {
        //                    //console.log(JSON.parse(data.data));
        //                    ZcArr = JSON.parse(data.data);
        //                    //console.log(ZcArr);
           
        //                } else {
        //                    //alert("获取交通类型失败");
        //                }
        //    },
        //            error: function (e) {
        //                //console.log(e)
        //            }
        //        })
        //        var showTrainPickerButton = doc.getElementById('showTrainPicker');
             
        //        //console.log(showUserPicker);
        //    //弹框
        //        function tatle(data) {
        //            layer.open({
        //    content: data
        //                                 , skin: 'msg'
        //                                 , time: 3 //2秒后自动关闭
        //});
        //}
        ////    //领队根据职称判断交通类型
        ////        showTrainPickerButton.addEventListener('tap', function (event) {
              
        ////            var showUserPicker = doc.getElementById('showUserPicker');
        ////            var index = showUserPicker.selectedIndex;
        ////            //console.log(showUserPicker.options[index].text)
        ////            if (showUserPicker.options[index].text == '请选择职称') {
        ////                tatle('请选择职称');
        ////                return;
        ////            } else if (showUserPicker.options[index].text == '正高' || showUserPicker.options[index].text == '院领导') {
        ////                //console.log(ZcArr)
        ////                var html = "";
        ////                 for (var j = 0; j < ZcArr.length ; j++) {
        ////                         html += '<option>' + ZcArr[j].HC_Name + '</option>';
        ////}
        ////                 document.getElementById('showTrainPicker').innerHTML = html;
        ////} else {
        ////                var str = "";
        ////                var cd = [];
        ////                for (var i = 0; i < ZcArr.length ; i++) {
        ////                    if (ZcArr[i].vID == '11' || ZcArr[i].vID == '4' || ZcArr[i].vID == '5') {
        ////                        cd.push(ZcArr[i]);
        ////}
        ////}
        ////                //console.log(cd);
        ////                for (var j= 0; j < cd.length ; j++) {
        ////                    str += '<option>' + cd[j].HC_Name + '</option>';
        ////}
        ////                document.getElementById('showTrainPicker').innerHTML = str;
                       
        ////}

        ////}, false);

        //});
        //})(mui, document);
    </script>



        <script>
            //页面选择
            function selectSex(ele) {
                if (ele.firstElementChild.src.substring(ele.firstElementChild.src.lastIndexOf("/") + 1) == "no@2x.png") {
                    ele.firstElementChild.src = "img/xz@2x.png";
                    ele.parentNode.lastElementChild.firstElementChild.src = "img/wxz@2x.png";
                    ele.parentNode.setAttribute('data-sex','1')
                } else if (ele.firstElementChild.src.substring(ele.firstElementChild.src.lastIndexOf("/") + 1) == "wxz@2x.png") {
                    ele.firstElementChild.src = "img/xznv@2x.png";
                    ele.parentNode.setAttribute('data-sex', '0');
                    ele.parentNode.firstElementChild.firstElementChild.src = "img/no@2x.png";
                  
                } 
            }

            function selectYN(ele) {
                if (ele.firstElementChild.innerText == "是") {
                    ele.lastElementChild.src = "img/xz@2x.png";
                    ele.parentNode.firstElementChild.lastElementChild.src = "img/no@2x.png";
                    ele.parentNode.setAttribute("data_zz","1");
                } else {
                    ele.lastElementChild.src = "img/xz@2x.png";
                    ele.parentNode.lastElementChild.lastElementChild.src = "img/no@2x.png";
                    ele.parentNode.setAttribute("data_zz", "0");
                }
                if (ele.getAttribute("data_ZZ") == "yes") {
                    document.getElementById("zz1").setAttribute("class", "zz_yes");
                    document.getElementById("zz2").setAttribute("class", "zz_yes");
                    document.getElementById("zz3").setAttribute("class", "zz_yes");
                    document.getElementById("zz4").setAttribute("class", "zz_yes");
                } else {
                    document.getElementById("zz1").setAttribute("class", "zz_no");
                    document.getElementById("zz2").setAttribute("class", "zz_no");
                    document.getElementById("zz3").setAttribute("class", "zz_no");
                    document.getElementById("zz4").setAttribute("class", "zz_no");
                }
                if (ele.getAttribute("data_px") == "yes") {
                    document.getElementById("hy_1").setAttribute("class", "zz_no");
                    document.getElementById("hy_2").setAttribute("class", "zz_no");
                    document.getElementById("PX_no").setAttribute("style", "float:right;");
                } else {
                    document.getElementById("hy_1").setAttribute("class", "zz_yes");
                    document.getElementById("hy_2").setAttribute("class", "zz_yes");
                }
            }
        </script>
        <script>
            function flowPeople() {
                //缓存时间
                //localStorage.setItem("CCDate", document.getElementById("CCDate").value);
                //localStorage.setItem("Time", document.getElementById("Time").value);
                localStorage.setItem("lsData1", document.getElementById("lsData1").innerHTML)
                localStorage.setItem("lsData2", document.getElementById("lsData2").innerHTML)
                localStorage.setItem("area4", document.getElementById("area4").innerHTML)
                if (localStorage.getItem("flows")) {
                    var arr = JSON.parse(localStorage.getItem("flows"));
                } else {
                    var arr = [];
                }
                var flows = document.getElementsByClassName("ScName");
                //var _flows = JSON.parse(localStorage.getItem("flows"));
                if (!localStorage.getItem("flows")) {
                    for (var i = 0; i < flows.length; i++) {
                        arr.push(flows[i].getAttribute("data-all"))
                    }
                    localStorage.setItem("flows", JSON.stringify(arr));
                }
                window.location = "FlowPeople.html";
            }
            //if (localStorage.getItem('CCDate') || localStorage.getItem('Time')) {
            //    document.getElementById("CCDate").value = localStorage.getItem('CCDate');
            //    document.getElementById("Time").value = localStorage.getItem('Time')
            //}
            if (document.getElementById("showUserPicker").value != "请选择职称") {

                document.getElementById("showUserPicker").style.color = "#000";
            }
                //点击时删除请选择职称选项
             $('#showUserPicker').on('click', function () {
                 this.style.color = '#000';
                 document.getElementById("showUserPicker").style.color = '#000';
            });
            $('#showTrainPicker').on('click', function () {
                this.style.color = '#000';
            });
            $(document).on('click','.SelectJob', function () {
                $(this).css('color', '#000');
               
            });
        </script>
        <script>
            if (localStorage.getItem('flows')) {
                var ss = localStorage.getItem('flows');
            } else {
                //var ss = [];
            }
       
            if (localStorage.getItem('PreSQ')) {
                //console.log(JSON.parse(localStorage.getItem('PreSQ')).ID);
                _DepId =JSON.parse(localStorage.getItem('PreSQ')).ID;
            }

            //缓存人员列表带过来的数据
            //console.log($('#entourage'));
            localStorage.setItem("local", document.getElementById("entourage").innerHTML)
         
            console.log(localStorage.getItem('local'));
            //添加随从人员住宿数据
            $.ajax({
                async: false,
                type: "get",
                dataType: 'json',
                url: 'http://120.27.217.7:7001/CLFApply/WBS/CLFApply/CLFApplyWBS.asmx/WBS_GetCCSTList?CCID=' + _DepId,
                success: function (data) {
                    gg = JSON.parse(data.data);

                    if (localStorage.getItem('PreSQ')) {
                        var str = '';
                        for (var i = 0; i < gg.length; i++) {
                            //console.log(JSON.parse(ss)[i].replace(/\s/g, "|").split('||||'));
                            if (localStorage.getItem("flows")) {
                                var flows = JSON.parse(localStorage.getItem("flows"))
                                for (var i = 0; i < flows.length; i++) {
                                    if (flows[i].PersonID == gg.PersonID) {
                                        continue;
                                    }
                                }
                            }
                            str += '<table>';
                            str += '<tbody><tr>';
                            str += '<td class="td_1" onclick="closePeople(this)" data-remove="' + gg[i].vName + '"><span class="ScName td-left"  data-all=\'' + JSON.stringify(gg[i]) + '\' style="display:flex;align-item:center;"><img src="img/guanbi@2x.png">' + gg[i].vName + '</span></td>';
                            str += '<td class="td_2">';
                            str += '<select class="SelectJob" onchange="SelectJob(this)" style="font-size:15px;height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">';
                            str += '<option value="请选择职称" selected disabled="disabled">请选择职称</option>';
                            str += '<option value="院领导">院领导</option>';
                            str += '<option value="正高">正高</option>';
                            str += '<option value="中层干部">中层干部</option>';
                            str += '<option value="其他人员" >其他人员</option>';
                            str += '</select>';
                            str += '</td>';
                            str+='<td class="td_3 dataSex" data-sex="1" style="display:flex;justify-content:space-around;">';
                            str+='<div onclick="selectSex(this)"style="display: flex;align-items:center;" >';
                            str += '<img src="img/no@2x.png"><span style="padding-top:3px;">男</span>';
                            str+='</div>';
                            str += '<div onclick="selectSex(this)" style="display: flex;align-items:center;"><img src="img/wxz@2x.png"><span style="padding-top:3px;">女</span>';
                            str += '</div></td>';

                           
                            str += '</tr></tbody></table>';
                        }
                        $('#entourage').append(str);

                        var flows = document.getElementsByClassName("ScName");
                        if (localStorage.getItem("flows")) {
                            var arr = JSON.parse(localStorage.getItem("flows"))
                        } else {
                            var arr = [];
                        }
                        for (var i = 0; i < flows.length; i++) {
                            arr.push(flows[i].getAttribute("data-all"))
                        }
                        localStorage.setItem("flows", JSON.stringify(arr))
                        
                        var html = '';
                        for (var i = 0; i < gg.length; i++) {
                            html += '<table data-remove="' + gg[i].vName + '">';
                            html += '<tr>';
                            html += '<td class="td_1" data-remove="' + gg[i].vName + '" id="RemoveName"><span class="td-left">' + gg[i].vName + '</span></td>';
                            html += '<td class="td_2">';
                            html += '<select id="showUserPicker" class="SelectTraffic" style="font-size:15px; height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">'
                            html += '<option value="请选择交通类型" selected disabled="disabled">请选择交通类型</option>'
                            html += '</select>'
                            html += '</select>';
                            html += '</td>';
                            html += '</tr>';
                            html += ' <tr><td class="td_1"><span class="td-left">车票(往)</span></td><td class="td_2"><input type="text" class="leaveMoney IsNum" placeholder="请输入金额" /></td></tr>';
                            html += '<tr><td class="td_1"><span class="td-left">车票(返)</span></td><td class="td_2"><input type="text" class="returnMoney IsNum" placeholder="请输入金额" /></td></tr>';
                            html += '<tr><td class="td_1"><span class="td-left">交通实报</span></td><td class="td_2"><input type="text" class="realMoney" placeholder="--" readonly  /></td></tr>';
                            html += '</table>';
                        }
                        $('#_entourage').append(html);
                        //console.log(html)


                    }
                 


                },
                error:function(){
                }
            })

            

       
            var str = '';
            if (ss) {
                for (var i = 0; i < JSON.parse(ss).length; i++) {
                    //console.log(JSON.parse(ss)[i].replace(/\s/g, "|").split('||||'));
                    //console.log(JSON.parse(JSON.parse(ss)[i]).vName)
                    str += '<table>';
                    str+='<tbody><tr>';
                    str += '<td class="td_1" onclick="closePeople(this)" data-remove="' + JSON.parse(JSON.parse(ss)[i]).vName + '"><span class="ScName td-left"  data-all=\'' + JSON.parse(ss)[i]+ '\' style="display:flex;align-item:center;"><img src="img/guanbi@2x.png">' + JSON.parse(JSON.parse(ss)[i]).vName + '</span></td>';
                    str+='<td class="td_2">';
                    str += '<select class="SelectJob" onchange="SelectJob(this)" style="font-size:15px;height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">';
                    str += '<option value="请选择职称" selected disabled="disabled">请选择职称</option>';
                    str += '<option value="院领导">院领导</option>';
                    str += '<option value="正高">正高</option>';
                    str+='<option value="中层干部">中层干部</option>';
                    str += '<option value="其他人员" >其他人员</option>';
             
                    str+='</select>';
                    str += '</td>';
                    str += '<td class="td_3 dataSex" data-sex="1" style="display:flex;justify-content:space-around;">';
                    str += '<div onclick="selectSex(this)"style="display: flex;align-items:center;" >';
                    str += '<img src="img/no@2x.png"><span style="padding-top:3px;">男</span>';
                    str += '</div>';
                    str += '<div onclick="selectSex(this)" style="display: flex;align-items:center;"><img src="img/wxz@2x.png"><span style="padding-top:3px;">女</span>';
                    str += '</div></td>';




                    //str += '<td class="td_3 dataSex" ><span onclick="selectSex(this)" style="float:right;padding-right:15px;padding-left:15px;align-items: center;">';
                    //str+='<span style="float:right;padding-top:5px;">女</span>';
                    //str+='<img src="img/wxz@2x.png" style="float:right">';
                    //str+='</span><span onclick="selectSex(this)" style="float:right;align-items: center;"><span style="float:right;padding-top:5px;">男</span>';
                    //str+='<img src="img/no@2x.png" style="float:right"></span></td>';
                    str+='</tr></tbody></table>';
                }
            }
            $('#entourage').append(str);
            //添加随从人员交通数据
            var html = '';

            for (var i = 0; i < JSON.parse(ss).length; i++) {
                //console.log(JSON.parse(ss)[i].replace(/\s/g, "|").split('||||'));
                html += '<table data-remove="' + JSON.parse(JSON.parse(ss)[i]).vName + '">';
                html+='<tr>';
                html += '<td class="td_1" data-remove="' + JSON.parse(JSON.parse(ss)[i]).vName + '" id="RemoveName"><span class="td-left">' + JSON.parse(JSON.parse(ss)[i]).vName + '</span></td>';
                html+='<td class="td_2">';
                html += '<select id="showUserPicker" class="SelectTraffic" style="font-size:15px; height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">'
                html += '<option value="请选择交通类型" selected>请选择交通类型</option>'
                html += '</select>'
                html +='</select>';
                html +='</td>';
                html +='</tr>';
                html += ' <tr><td class="td_1"><span class="td-left">车票(往)</span></td><td class="td_2"><input type="text" class="leaveMoney IsNum" placeholder="请输入金额" /></td></tr>';
                html += '<tr><td class="td_1"><span class="td-left">车票(返)</span></td><td class="td_2"><input type="text" class="returnMoney IsNum" placeholder="请输入金额" /></td></tr>';
                html += '<tr><td class="td_1"><span class="td-left">交通实报</span></td><td class="td_2"><input type="text" class="realMoney" placeholder="--" readonly  /></td></tr>';
                html += '</table>'; 
            }
            $('#_entourage').append(html);

            //if (_Ss) {
            //    //console.log(JSON.parse(JSON.parse(_Ss)));
            //    var str = '';
            //    for (var i = 0; i < JSON.parse(ss).length; i++) {
            //        //console.log(JSON.parse(ss)[i].replace(/\s/g, "|").split('||||'));
            //        //console.log(JSON.parse(JSON.parse(ss)[i]).vName)
            //        str += '<table>';
            //        str += '<tbody><tr>';
            //        str += '<td class="td_1" onclick="closePeople(this)" data-remove="' + JSON.parse(JSON.parse(_Ss)[i]).vName + '"><span class="ScName td-left"  style="display:flex;align-item:center;"><img src="img/guanbi@2x.png">' + JSON.parse(JSON.parse(_Ss)[i]).vName + '</span></td>';
            //        str += '<td class="td_2">';
            //        str += '<select class="SelectJob" onchange="SelectJob(this)" style="font-size:15px;height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">';
            //        str += '<option value="院领导">院领导</option>';
            //        str += '<option value="正高">正高</option>';
            //        str += '<option value="中层干部">中层干部</option>';
            //        str += '<option value="其他人员" >其他人员</option>';
            //        str += '<option value="请选择职称" selected>请选择职称</option>';
            //        str += '</select>';
            //        str += '</td>';
            //        str += '<td class="td_3 dataSex" ><span onclick="selectSex(this)" style="float:right;padding-right:15px;padding-left:15px;align-items: center;">';
            //        str += '<span style="float:right;padding-top:5px;">女</span>';
            //        str += '<img src="img/wxz@2x.png" style="float:right">';
            //        str += '</span><span onclick="selectSex(this)" style="float:right;align-items: center;"><span style="float:right;padding-top:5px;">男</span>';
            //        str += '<img src="img/no@2x.png" style="float:right"></span></td>';
            //        str += '</tr></tbody></table>';
            //    }
            //    $('#entourage').append(str);
            //    //添加随从人员交通数据
            //    var html = '';

            //    for (var i = 0; i < JSON.parse(_Ss).length; i++) {
            //        //console.log(JSON.parse(ss)[i].replace(/\s/g, "|").split('||||'));
            //        html += '<table data-remove="' + JSON.parse(JSON.parse(_Ss)[i]).vName + '">';
            //        html += '<tr>';
            //        html += '<td class="td_1" data-remove="' + JSON.parse(JSON.parse(_Ss)[i]).vName + '" id="RemoveName"><span class="td-left">' + JSON.parse(JSON.parse(_Ss)[i]).vName + '</span></td>';
            //        html += '<td class="td_2">';
            //        html += '<select id="showUserPicker" class="SelectTraffic" style="font-size:15px; height:20px;margin-top:0;border:1px solid #f5f5f5;padding:0;margin-bottom:0;">'
            //        html += '<option value="请选择交通类型" selected>请选择交通类型</option>'
            //        html += '</select>'
            //        html += '</select>';
            //        html += '</td>';
            //        html += '</tr>';
            //        html += ' <tr><td class="td_1"><span class="td-left">车票(往)</span></td><td class="td_2"><input type="text" class="leaveMoney IsNum" placeholder="请输入金额" /></td></tr>';
            //        html += '<tr><td class="td_1"><span class="td-left">车票(返)</span></td><td class="td_2"><input type="text" class="returnMoney IsNum" placeholder="请输入金额" /></td></tr>';
            //        html += '<tr><td class="td_1"><span class="td-left">交通实报</span></td><td class="td_2"><input type="text" class="realMoney" placeholder="--" readonly  /></td></tr>';
            //        html += '</table>';
            //    }
            //    $('#_entourage').append(html);
            
            
            //}



            //缓存人员列表带过来的数据
            //console.log($('#entourage'));
            //localStorage.setItem("local", document.getElementById("entourage").innerHTML)

            //console.log(localStorage.getItem('local'));
           




                //点击时删除随从人员中某一个
            function closePeople(ele) {
                var RemoveName = document.querySelectorAll('#RemoveName');
                //console.log(ele)
                $(ele.parentNode).remove();
                //for (var j = 0; j < JSON.parse(ss).length; j++) {
                //    if (JSON.parse(JSON.parse(ss)[j]).vName == ele.getAttribute('data-remove')) {
                //    }
                
                //}

                var _flows = document.getElementById("_entourage").children
                for (var i = 0; i < _flows.length; i++) {
                    if (_flows[i].getAttribute("data-remove") == ele.getAttribute("data-remove")) {
                        $(_flows[i]).remove();
                    }
                }

                //console.log(RemoveName);
                for (var i = 0; i < RemoveName.length; i++) {
                    if (RemoveName[i].getAttribute('data-remove') == ele.getAttribute('data-remove')) {
                        RemoveName[i].parentNode.parentNode.remove();
                    }
                }
               
                if (localStorage.getItem("flows")) {
                    var flows = JSON.parse(localStorage.getItem("flows"));
                    for (var i = 0; i < flows.length; i++) {
                        if (JSON.parse(flows[i]).PersonID == JSON.parse(ele.firstElementChild.getAttribute("data-all")).PersonID) {
                            flows.splice(i, 1);
                            localStorage.setItem("flows", JSON.stringify(flows));
                        }
                    }
                }
            }



            //随从人员交通报销金额
            var leaveMoney = document.querySelectorAll('.leaveMoney');
            var returnMoney = document.querySelectorAll('.returnMoney');
            var realMoney = document.querySelectorAll('.realMoney');
            for (var i = 0; i < leaveMoney.length; i++) {
                bb = leaveMoney[i];
                ee = returnMoney[i];
                leaveMoney[i].onkeyup = function (){
                    leav = this.value;
                    ret = this.parentNode.parentNode.nextSibling.lastElementChild.lastElementChild.value;
                    real = this.parentNode.parentNode.nextSibling.nextSibling.lastElementChild.lastElementChild;
                    if (!leav && ret) {
                        real.value = parseFloat(ret);
                    } else if (leav && !ret) {
                        real.value = parseFloat(leav);
                    } else if (leav && ret) {
                        real.value = parseFloat(leav) + parseFloat(ret);
                    } else if (!leav && !ret) {
                        real.value = "";
                    }
                };
                returnMoney[i].onkeyup = function () {
                    leav = this.parentNode.parentNode.previousSibling.lastElementChild.lastElementChild.value;
                    ret = this.value;
                    real = this.parentNode.parentNode.nextSibling.lastElementChild.lastElementChild;
                    if (!leav && ret) {
                        real.value = parseFloat(ret);
                    } else if (leav && !ret) {
                        real.value = parseFloat(leav);
                    } else if (leav && ret) {
                        real.value = parseFloat(leav) + parseFloat(ret);
                    } else if (!leav && !ret) {
                        real.value = "";
                    }
                };
            }
            //点击确定判断必输项
            //确定操作
            //弹框
            function tatle(data) {
                layer.open({
                    content: data
                    , skin: 'msg'
                   , time: 3 //2秒后自动关闭
                });
            }
            function nextInfo() {
                var showUserPicker = document.getElementById('showUserPicker');
                var index = showUserPicker.selectedIndex;
                if(!document.getElementById("leadSex").getAttribute("data-sex")){
                    tatle('请选择出差人员性别');
                    return;
                }
                if (showUserPicker.options[index].text == '请选择职称') {
                    tatle('请选择职称');
                    return;
                }
                if (!document.getElementById("originBear").getAttribute("data_zz")) {
                    tatle('请选择是否组织单位');
                    return;
                }

                for (var i = 0; i < $('.dataSex').length; i++) {
                    if (!$('.dataSex')[i].getAttribute('data-sex')) {
                        tatle('请选择随从人员性别');
                        return;
                    }
                }
                if (document.getElementById("originBear").getAttribute("data_zz") == "0") {
                    if (document.getElementById("roomNum").value == "") {
                        tatle('请输入住宿间数');
                        return;
                    } else if (document.getElementById("ZSMoney").value == "") {
                        tatle('请输入报销金额');
                        return;
                    }
                }
                //判断出差人员交通情况   
                if(document.getElementById("showTrainPicker").innerText == "请选择类型"){
                    tatle('请选择出差人员交通类型');
                    return;
                }else if (document.getElementById("leaveMoney").value == "") {
                    tatle('请输入车票金额');
                    return;
                } else if (document.getElementById("returnMoney").value == "") {
                    tatle('请输入车票金额');
                    return;
                }
               
               
                //判断随从人员车票离开价格
                for (var i = 0; i < $('.leaveMoney').length; i++) {
                    if ($('.leaveMoney')[i].value == '') {
                        tatle('请选择随从人员出发车票价格');
                        return;
                    }
                }
                //判断随从人员车票返回价格
                for (var i = 0; i < $('.returnMoney').length; i++) {
                    if ($('.returnMoney')[i].value == '') {
                        tatle('请选择随从人员返回车票价格');
                        return;
                    }
                }
                if (!document.getElementById("meetPlan").getAttribute("data_zz")) {
                    tatle('请选择是否参加会议培训');
                    return;
                }
            
                //存储数据保存另一个页面
                var obj = {};
                //新建随从人员数组
                obj.vName = $('#vName').text();
                obj.leadSex = $('#leadSex').attr('data-sex');
                obj.DepName = $('#DepName').text();
                obj.showUserPicker = showUserPicker.options[index].text;
                obj.CCDate = $("#CCDate").val()+"--"+$("#Time").val();
                obj.CCDays = $('#CCDays').text();
                obj.CCAddress = $('#CCAddress').text();
                obj.originBear = $('#originBear').attr('data_zz');
                //获取随从人员姓名
                var tt = [];
                for (var i = 0; i < $('#entourage table').length; i++) {
                    var SelectJob = document.querySelectorAll('.SelectJob');
                    var index = SelectJob[i].selectedIndex;
                var ss = {};
                ss.vName = $('#entourage table')[i].lastElementChild.lastElementChild.firstElementChild.lastElementChild.innerText;
                ss.zcName = $('#entourage table')[i].lastElementChild.lastElementChild.children[1].lastElementChild.options[index].text;
                ss.sex = $('#entourage table')[i].lastElementChild.lastElementChild.lastElementChild.getAttribute('data-sex');
                 tt.push(ss);
                }
                obj.ScInfo = tt;
                if ($('#originBear').attr('data_zz') == '0') {
                    obj.ZSDays = $('#ZSDays').text();
                    obj.roomNum = $('#roomNum').val();
                    obj.ZSMoney = $('#ZSMoney').val();
                    obj.ZSRealMoney = $('#ZSRealMoney').val();
                }
                //出差人员火车类型
                var showUserPicker = document.getElementById('showTrainPicker');
                var index = showUserPicker.selectedIndex;
                obj.showTrainPicker = showUserPicker.value;
               
                obj.leaveMoney = $('#leaveMoney').val();
                obj.returnMoney = $('#returnMoney').val();
                obj.realMoney = $('#realMoney').val();
               

               
                //随从人员交通信息
                var _arr = [];
                for (var i = 0; i < $('#_entourage table').length; i++) {
                    var str = {};
                    str.vName = $('#_entourage table')[i].lastElementChild.firstElementChild.firstElementChild.lastElementChild.innerText;
                    str.SelectTraffic = $('#_entourage table')[i].lastElementChild.firstElementChild.lastElementChild.lastElementChild.value;
                    str.leaveMoney = $('#_entourage table')[i].lastElementChild.children[1].lastElementChild.lastElementChild.value;
                    str.returnMoney = $('#_entourage table')[i].lastElementChild.children[2].lastElementChild.lastElementChild.value;
                    str.realMoney = $('#_entourage table')[i].lastElementChild.children[3].lastElementChild.lastElementChild.value;
                    _arr.push(str);
                }
                obj.TrafficInfo = _arr;
                obj.isPlan = $('#meetPlan').attr('data_zz');
                if ($('#meetPlan').attr('data_zz') == '1') {
                    obj.meetMoney = $('#meetMoney').val();
                    obj.meetRealMoney = $('#meetRealMoney').val();
                }
                //console.log(obj);
                localStorage.setItem('datas', JSON.stringify(obj));
                console.log(obj);
                //return;
                window.location = "TravelInfo.html";
            }
            //判断输入框只能输入数字
            $(document).on('input propertychange','.IsNum', function () {
                var c = $(this);
                if (/[^\d]/.test(c.val())) {//替换非数字字符
                    var temp_amount = c.val().replace(/[^0-9.]+/, '');
                    $(this).val(temp_amount);
                }
            })


        </script>




</body>
</html>
